{% extends "merchant_base.html" %}

{% block title %}Edit Invoice #{{ invoice.invoice_number }}{% endblock %}

{% block content %}
<h2>Edit Invoice #{{ invoice.invoice_number }}</h2>

<form method="post">
    {% csrf_token %}
    
    <div style="margin-bottom:15px;">
        <label>Invoice Number:</label>
        <input type="text" name="invoice_number" value="{{ invoice.invoice_number }}" required>
    </div>

    <div style="margin-bottom:15px;">
        <label>Description:</label>
        <textarea name="description" rows="3">{{ invoice.description }}</textarea>
    </div>

    <h3>Invoice Items</h3>
    <table id="items-table" style="width:100%; border-collapse:collapse; margin-bottom:15px;">
        <thead>
            <tr style="border-bottom:1px solid #ccc;">
                <th>Description</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice.items.all %}
            <tr>
                <td><input type="text" name="item_description[]" value="{{ item.description }}" required></td>
                <td><input type="number" name="item_quantity[]" value="{{ item.quantity }}" min="1" required></td>
                <td><input type="number" name="item_unit_price[]" value="{{ item.unit_price }}" step="0.01" min="0" required></td>
                <td><button type="button" onclick="removeRow(this)">Remove</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="button" onclick="addRow()">Add Item</button>

    <div style="margin-top:20px;">
        <button type="submit" style="padding:10px 20px; background:#28a745; color:white; border:none; border-radius:5px;">Save Invoice</button>
        <a href="{% url 'WA_provider:invoice_list' %}" style="margin-left:10px;">Cancel</a>
    </div>
</form>

<script>
function addRow() {
    const table = document.getElementById("items-table").getElementsByTagName('tbody')[0];
    const row = table.insertRow();
    row.innerHTML = `
        <td><input type="text" name="item_description[]" required></td>
        <td><input type="number" name="item_quantity[]" value="1" min="1" required></td>
        <td><input type="number" name="item_unit_price[]" value="0.00" step="0.01" min="0" required></td>
        <td><button type="button" onclick="removeRow(this)">Remove</button></td>
    `;
}

function removeRow(btn) {
    const row = btn.closest("tr");
    row.parentNode.removeChild(row);
}
</script>
{% endblock %}
