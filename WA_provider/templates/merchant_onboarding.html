<!-- templates/merchant/onboarding.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Merchant Onboarding</title>
    <style>
        .onboarding-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }
        .progress-steps:before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e0e0e0;
            z-index: 1;
        }
        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }
        .step.active .step-circle {
            background: #4CAF50;
            color: white;
        }
        .step.completed .step-circle {
            background: #2196F3;
            color: white;
        }
        .step-label {
            font-size: 14px;
            color: #666;
        }
        .step.active .step-label {
            color: #4CAF50;
            font-weight: bold;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        
        <!-- Progress Steps -->
        <div class="progress-steps">
            {% for step_value, step_label in steps %}
                <div class="step 
                    {% if step_value == current_step %}active
                    {% elif step_index < current_index %}completed{% endif %}">
                    <div class="step-circle">{{ forloop.counter }}</div>
                    <div class="step-label">{{ step_label }}</div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Form -->
        <div class="form-container">
            <h2>
                {% if current_step == 'basic_info' %}Business Information
                {% elif current_step == 'verification' %}Identity Verification
                {% elif current_step == 'bank_details' %}Bank Details
                {% elif current_step == 'subscription' %}Select Subscription Plan
                {% endif %}
            </h2>
            
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                
                {% if current_step == 'basic_info' %}
                    <div class="form-group">
                        <label>Business Name *</label>
                        {{ form.name }}
                        {{ form.name.errors }}
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        {{ form.phone }}
                        {{ form.phone.errors }}
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        {{ form.email }}
                        {{ form.email.errors }}
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        {{ form.city }}
                        {{ form.city.errors }}
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        {{ form.address }}
                        {{ form.address.errors }}
                    </div>
                
                {% elif current_step == 'verification' %}
                    <div class="form-group">
                        <label>ID Document (Passport/National ID) *</label>
                        <p class="help-text">Upload a clear photo of your ID (PDF, JPG, PNG)</p>
                        {{ form.id_document }}
                        {{ form.id_document.errors }}
                    </div>
                    <div class="form-group">
                        <label>Business License (Optional)</label>
                        <p class="help-text">If you have a business license</p>
                        {{ form.business_license }}
                        {{ form.business_license.errors }}
                    </div>
                
                {% elif current_step == 'bank_details' %}
                    <div class="form-group">
                        <label>LyPay Number</label>
                        {{ form.lypay_number }}
                        <small>For LyPay settlements</small>
                        {{ form.lypay_number.errors }}
                    </div>
                    <div class="form-group">
                        <label>Bank IBAN</label>
                        {{ form.bank_iban }}
                        <small>For bank transfers</small>
                        {{ form.bank_iban.errors }}
                    </div>
                    <p class="help-text">Note: At least one payment method is required</p>
                
                {% elif current_step == 'subscription' %}
                    <div class="subscription-plans">
                        {% for choice in form.package.field.queryset %}
                            <div class="plan-card">
                                <input type="radio" 
                                       name="package" 
                                       value="{{ choice.id }}" 
                                       id="plan-{{ choice.id }}"
                                       {% if forloop.first %}checked{% endif %}>
                                <label for="plan-{{ choice.id }}">
                                    <h3>{{ choice.name }}</h3>
                                    <div class="price">${{ choice.monthly_price }}/month</div>
                                    <ul>
                                        <li>{{ choice.transaction_fee_percent }}% transaction fee</li>
                                        <li>{{ choice.max_payment_links }} payment links</li>
                                        <li>24/7 Support</li>
                                    </ul>
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                    {{ form.package.errors }}
                
                {% endif %}
                
                <div class="form-navigation">
                    {% if current_step != 'basic_info' %}
                        <a href="?step={{ previous_step }}" class="btn btn-secondary">
                            ← Previous
                        </a>
                    {% else %}
                        <div></div> <!-- Empty div for spacing -->
                    {% endif %}
                    
                    <button type="submit" class="btn btn-primary">
                        {% if current_step == 'subscription' %}Complete Onboarding
                        {% else %}Save & Continue →
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Auto-advance to next step after successful submission
        {% if messages %}
            {% for message in messages %}
                {% if 'success' in message.tags %}
                    setTimeout(function() {
                        // If not on the last step, auto-advance
                        {% if current_step != 'completed' %}
                            window.location.href = "?step={{ next_step }}";
                        {% endif %}
                    }, 1000);
                {% endif %}
            {% endfor %}
        {% endif %}
    </script>
</body>
</html>